{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5f855b2-7344-44ad-bf8b-75bccd63d288","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":false,"position":"right"},"$invalid":false},"$invalid":false,"$$hashKey":"object:9132"}],"$conditionOutputs":[{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"],"$$hashKey":"object:9158"}],"$connId":"con_3","$invalid":false,"$$hashKey":"object:9138"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"onboarding","root":true,"$position":{"top":"118px","left":"342px"},"$title":"In√≠cio","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"95b10ba8-e351-4d16-9b10-ce14961cb1fd","type":"text/plain"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"fallback","$position":{"top":"587px","left":"358px"},"$title":"Exce√ß√µes","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$$hashKey":"object:450","$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Ol√° {{contact.name}}!\n√â um prazer falar com voc√™ üòä"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Ol√° {{contact.name}}!\n√â um prazer falar com voc√™ üòä"},"editable":true,"deletable":true,"position":"left"}},"$$hashKey":"object:451","$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cf8c9892-92a7-4a39-b169-9b8f5f7ef7a4","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$$hashKey":"object:452","$invalid":false}],"$conditionOutputs":[{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$connId":"con_13","conditions":[{"source":"input","comparison":"matches","values":[".*"],"$$hashKey":"object:6543"}],"$invalid":false,"$$hashKey":"object:6523"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackAnyAttendance","$invalid":false,"settings":{"extras":{},"category":"AtendimentosTotais","action":"AtendimentosTotais"},"$$hashKey":"object:3410"}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"welcome","$position":{"top":"250px","left":"342px"},"$title":"1.0 - Boas vindas","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4369"},{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, n√£o consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, n√£o consegui entender!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4370"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1f34699-dd5c-43b6-8345-fde58dc32c0d","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false,"$$hashKey":"object:4371"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"error","$position":{"top":"587px","left":"596px"},"$title":"Erro padr√£o","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7fb24b66-f182-4a6b-82ec-17cd0d87cf16","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$$hashKey":"object:1019","$invalid":false}],"$conditionOutputs":[{"stateId":"3c555d39-68eb-466b-9063-6adeb01132fc","$connId":"con_18","conditions":[{"source":"context","comparison":"equals","values":["false"],"$$hashKey":"object:3446","variable":"isWorkTime"}],"$invalid":false,"$$hashKey":"object:3423"},{"stateId":"33c26b01-cf73-4b33-b80f-5340d49d701e","$connId":"con_23","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:16805"}],"$invalid":false,"$$hashKey":"object:16758"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"CheckWorkTime","$invalid":false,"settings":{"function":"run","source":"//Default BLiP TimeZoneOffset = S√£o Paulo (GMT-3)\nvar DEFAULT_OFFSET = 3;\n\n// Receive the variables as parameters\nfunction run(offset, start, end, workDays) {\n\n    offset = parseInt(offset) + DEFAULT_OFFSET;\n\n    let today = nowUTC(offset);\n    let startDate = utcDate(start, offset);\n    let endDate = utcDate(end, offset);\n\n    return ((today - startDate) > 0) && ((endDate - today) > 0) && isWorkDay(today, workDays);\n}\n\n//Get now UTC Date\nfunction nowUTC(offset){\n    let now = new Date;\n    let utc_timestamp = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),\n        now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds(), now.getUTCMilliseconds());\n\n    return new Date(utc_timestamp + offset * 3600 * 1000);\n}\n\n//Get UTC Date\nfunction utcDate(timeString, offset){\n    let now = new Date;\n\n    let hour = getValueByString('hour', timeString);\n    let minutes = getValueByString('minutes', timeString)\n\n    hour += DEFAULT_OFFSET;\n\n    let utc_timestamp = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),\n        hour, minutes, 0, 0);\n    return new Date(utc_timestamp + offset * 3600 * 1000);\n}\n\n//Get hour/minute by string with pattern HH:mm\nfunction getValueByString(type, timeString){\n\n    if(type === 'hour'){\n        return parseInt(timeString.substring(0, timeString.indexOf(':')));\n    }\n        \n    else if(type === 'minutes'){\n        return parseInt(timeString.substring(timeString.indexOf(':') + 1, timeString.length));\n    }\n\n    return 0;\n}\n\n//Get if today is a work day\nfunction isWorkDay(today, workDays){\n    workDays = workDays.split(',');\n\n    return workDays.indexOf(today.getDay().toString()) >= 0;\n}","inputVariables":["config.dateTimeOffset","config.startDate","config.endDate","config.workDays"],"outputVariable":"isWorkTime"},"$$hashKey":"object:3809"}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","root":false,"$title":"2.0 - Verifica Hor√°rio Atendimento","$position":{"top":"239px","left":"606px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"95118c04-1f32-40df-b1b0-54fb24fa2fc7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"425aa5d2-fcf9-4094-a52c-73917f47875c","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$$hashKey":"object:1162","$invalid":false}],"$conditionOutputs":[{"stateId":"143e0124-ec4e-462d-8369-efc61791afe6","$connId":"con_28","conditions":[{"source":"context","comparison":"equals","values":["false"],"$$hashKey":"object:15320","variable":"hasAttendant"}],"$invalid":false,"$$hashKey":"object:15309"},{"stateId":"4c0d9be0-bd3d-4e72-b105-a2ac741e5149","$connId":"con_33","conditions":[{"source":"context","comparison":"equals","values":["true"],"$$hashKey":"object:29949","variable":"hasAttendant"}],"$invalid":false,"$$hashKey":"object:29938"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"CheckAgentsAvailability","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Key {{config.token}}"},"method":"POST","body":"{\n  \"id\": \"{{random.guid}}\",\n  \"from\": \"{{application.identifier}}@{{application.domain}}\",  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/attendants\"\n}","uri":"https://msging.net/commands","responseStatusVariable":"status","responseBodyVariable":"result"},"$$hashKey":"object:10425","conditions":[]},{"type":"ExecuteScript","$title":"HandleCheckRequest","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(result) {\n    result = JSON.parse(result)\n    let hasAttendant = false;\n    \n    // Update the value with your team name\n    let team = 'Equipe1';\n\n    if(result.resource && result.resource.total >= 1){\n        hasAttendant  = result.resource.items.some(function(attendant){\n            return (attendant.status === 'Online' && attendant.teams.includes(team));\n        });\n    }\n    return hasAttendant;\n}","inputVariables":["result"],"outputVariable":"hasAttendant"},"$$hashKey":"object:11605","conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"95118c04-1f32-40df-b1b0-54fb24fa2fc7","root":false,"$title":"3.0.1 - Verifica Disponibilidade (Equipe1,Default)","$position":{"top":"11px","left":"1161px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3c555d39-68eb-466b-9063-6adeb01132fc":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"aa0d29d3-bab1-427d-9188-93b3638acbcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"aa0d29d3-bab1-427d-9188-93b3638acbcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:7178"},{"action":{"type":"SendMessage","settings":{"id":"504721a0-3d44-4e95-82cc-dd33718b906a","type":"text/plain","content":"Infelizmente n√£o temos atendentes dispon√≠veis agora. Nosso hor√°rio de atendimento √© de {{config.startDate}} a {{config.endDate}}"},"$cardContent":{"document":{"id":"504721a0-3d44-4e95-82cc-dd33718b906a","type":"text/plain","content":"Infelizmente n√£o temos atendentes dispon√≠veis agora. Nosso hor√°rio de atendimento √© de {{config.startDate}} a {{config.endDate}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:7179"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"fd1c385b-7adc-4efb-b829-3b137d4e97c0","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$$hashKey":"object:1457","$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackRequestsOutWorkTime","$invalid":false,"settings":{"extras":{},"category":"Solicita√ß√£o","action":"Fora Horario Atendimento"},"$$hashKey":"object:2108"}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$invalid":false},"id":"3c555d39-68eb-466b-9063-6adeb01132fc","root":false,"$title":"2.1 - Fora do Hor√°rio de Atendimento","$position":{"top":"390px","left":"744px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:b69ef3a2-9983-48f8-9d40-16bad478a460":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b04c3ac0-5b0c-4f61-ade4-9adbd31ae1fc","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$$hashKey":"object:2535","$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$$hashKey":"object:2539","$invalid":false,"stateId":"2b9bfb62-6346-4762-99ab-733d0c00d1a3","$connId":"con_38"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$$hashKey":"object:2540","$invalid":false,"stateId":"2b9bfb62-6346-4762-99ab-733d0c00d1a3","$connId":"con_43"}],"$enteringCustomActions":[{"type":"ForwardMessageToDesk","settings":{},"$invalid":false}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","$invalid":false},"id":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","root":false,"$title":"4.0 - Atendimento humano","$position":{"top":"239px","left":"1814px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2b9bfb62-6346-4762-99ab-733d0c00d1a3":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b950d0ee-cd9b-4aec-949b-02b8242cbeea","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b950d0ee-cd9b-4aec-949b-02b8242cbeea","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:8877"},{"action":{"type":"SendMessage","settings":{"id":"90ec55b8-aadd-4f92-bf1a-dec84eb60244","type":"text/plain","content":"Atendimento finalizado!"},"$cardContent":{"document":{"id":"90ec55b8-aadd-4f92-bf1a-dec84eb60244","type":"text/plain","content":"Atendimento finalizado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:8878"},{"action":{"type":"SendMessage","settings":{"id":"8b33aca6-bda4-4dec-8a22-5b5f51a2ec53","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8b33aca6-bda4-4dec-8a22-5b5f51a2ec53","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:8323"},{"action":{"type":"SendMessage","settings":{"id":"6bfaa60e-ce61-43fb-978e-80b1c5a15d8d","type":"text/plain","content":"Em uma escala de 0 a 10, onde 0 √© nada satisfeito e 10 √© totalmente satisfeito, qual nota voc√™ d√° para esse atendimento?"},"$cardContent":{"document":{"id":"6bfaa60e-ce61-43fb-978e-80b1c5a15d8d","type":"text/plain","content":"Em uma escala de 0 a 10, onde 0 √© nada satisfeito e 10 √© totalmente satisfeito, qual nota voc√™ d√° para esse atendimento?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:8324"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"64b7d83d-e2f4-4df4-8ad4-c9489c0f15f9","type":"text/plain","textContent":"Entrada do usu√°rio","content":"score"},"editable":false,"deletable":true,"position":"right"},"$invalid":false,"variable":"score"},"$$hashKey":"object:2716","$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a0151d70-16b1-455c-9534-a15acac75993","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}"}},"$cardContent":{"document":{"id":"a0151d70-16b1-455c-9534-a15acac75993","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:31269"},{"action":{"type":"SendMessage","settings":{"id":"dea1d712-9374-4990-8f99-5f38a06d5263","type":"text/plain","content":"Obrigado pela participa√ß√£o.","metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}"}},"$cardContent":{"document":{"id":"dea1d712-9374-4990-8f99-5f38a06d5263","type":"text/plain","content":"Obrigado pela participa√ß√£o."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:31270"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"NormalizeScore","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(score) {\n    if(isNumeric(score)){\n       score = parseInt(score);\n       if(score < 0) return 0;\n       if(score > 10) return 10;\n       return score;\n    }\n    return \"Outro\";\n}\n\n//check if a string has a number\nfunction isNumeric(num){\n  return !isNaN(num)\n}","inputVariables":["score"],"outputVariable":"score"},"$$hashKey":"object:10000"},{"type":"TrackEvent","$title":"TrackScoreValue","$invalid":false,"settings":{"extras":{},"category":"Score","action":"{{score}}"},"$$hashKey":"object:31556"}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"2b9bfb62-6346-4762-99ab-733d0c00d1a3","root":false,"$title":"5.0 - Nota de atendimento","$position":{"top":"239px","left":"2122px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"143e0124-ec4e-462d-8369-efc61791afe6":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"95011b31-5279-4d98-968d-b5af3c6d6b26","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"95011b31-5279-4d98-968d-b5af3c6d6b26","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:14938"},{"action":{"type":"SendMessage","settings":{"id":"2d2d011a-e3d5-4807-a347-d6cd9b3f43c8","type":"text/plain","content":"Desculpe, n√£o temos atendentes  dispon√≠veis nesta equipe no momento. Por favor, deixe me informe seu email ou telefone que entraremos em contato assim que poss√≠vel."},"$cardContent":{"document":{"id":"2d2d011a-e3d5-4807-a347-d6cd9b3f43c8","type":"text/plain","content":"Desculpe, n√£o temos atendentes  dispon√≠veis nesta equipe no momento. Por favor, deixe me informe seu email ou telefone que entraremos em contato assim que poss√≠vel."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:14939"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"76137ac2-42ab-4ee9-aef7-743cb9160a98","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$$hashKey":"object:14387","$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackRequestsWithoutAgent","$invalid":false,"settings":{"extras":{},"category":"Solicita√ß√£o","action":"Sem Atendente"},"$$hashKey":"object:2563","conditions":[]},{"type":"TrackEvent","$title":"TrackAbsoluteNotAvailableAgents","$invalid":false,"settings":{"extras":{},"category":"Atendentes Indispon√≠veis","action":"Atendentes Indispon√≠veis"},"$$hashKey":"object:2135","conditions":[]}],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"Nenhum atendente dispon√≠vel","action":"{{input.content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$invalid":false},"id":"143e0124-ec4e-462d-8369-efc61791afe6","root":false,"$title":"3.2 - Nenhum atendente dispon√≠vel","$position":{"top":"236px","left":"1165px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[]},"4c0d9be0-bd3d-4e72-b105-a2ac741e5149":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"adaea5c6-03e0-4ba5-9ef6-e1e3f9e9067e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"adaea5c6-03e0-4ba5-9ef6-e1e3f9e9067e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:28804"},{"action":{"type":"SendMessage","settings":{"id":"04835382-935c-4372-8778-69b4b0912d60","type":"text/plain","content":"A partir de agora um de nossos atendentes vai respond√™-lo."},"$cardContent":{"document":{"id":"04835382-935c-4372-8778-69b4b0912d60","type":"text/plain","content":"A partir de agora um de nossos atendentes vai respond√™-lo."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:28805"},{"action":{"type":"SendMessage","settings":{"id":"96272fb2-b301-4611-921b-69aa74791395","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"96272fb2-b301-4611-921b-69aa74791395","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:30858"},{"action":{"type":"SendMessage","settings":{"id":"8f63c111-4933-4e07-a9be-574ca9d0fbda","type":"text/plain","content":"Como podemos ajud√°-lo?"},"$cardContent":{"document":{"id":"8f63c111-4933-4e07-a9be-574ca9d0fbda","type":"text/plain","content":"Como podemos ajud√°-lo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:30859"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"86667929-c0a7-473d-b066-fbed10260d73","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$$hashKey":"object:28400","$invalid":false}],"$conditionOutputs":[{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","$connId":"con_48","conditions":[{"source":"input","comparison":"matches","values":[".*"],"$$hashKey":"object:30637"}],"$invalid":false,"$$hashKey":"object:30617"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackAttendances","$invalid":false,"settings":{"extras":{},"category":"AtendimentosRealizados","action":"AtendimentosRealizados"},"$$hashKey":"object:1433"}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"4c0d9be0-bd3d-4e72-b105-a2ac741e5149","root":false,"$title":"3.1 - Atendente dispon√≠vel","$position":{"top":"239px","left":"1546px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"33c26b01-cf73-4b33-b80f-5340d49d701e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"4d94fff0-1af2-443a-99e9-160a6dc7e68d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d94fff0-1af2-443a-99e9-160a6dc7e68d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:11481"},{"action":{"type":"SendMessage","settings":{"id":"857fdf99-f6d0-47ce-89df-140cfd29439a","type":"text/plain","content":"Qual equipe deseja falar?\n1- Equipe1\n2- Equipe2"},"$cardContent":{"document":{"id":"857fdf99-f6d0-47ce-89df-140cfd29439a","type":"text/plain","content":"Qual equipe deseja falar?\n1- Equipe1\n2- Equipe2"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:11482"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a77c189e-6773-4cd9-98c4-490bbfaec554","type":"text/plain","textContent":"Entrada do usu√°rio","content":"team"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"team"},"$$hashKey":"object:11165","$invalid":false}],"$conditionOutputs":[{"stateId":"95118c04-1f32-40df-b1b0-54fb24fa2fc7","$connId":"con_53","conditions":[{"source":"input","comparison":"contains","values":["1","um","Equipe1","primeiro"],"$$hashKey":"object:13591"}],"$$hashKey":"object:13569","$invalid":false},{"stateId":"20d3493e-41d0-45cc-bac4-43657d8883e1","$connId":"con_58","conditions":[{"source":"input","comparison":"contains","values":["2","dois","Equipe2","segundo"],"$$hashKey":"object:13612"}],"$$hashKey":"object:13570","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"team":"{{team}}"},"name":"{{contact.name}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"33c26b01-cf73-4b33-b80f-5340d49d701e","root":false,"$title":"Direcionamento conforme regras de atendimento","$position":{"top":"229px","left":"882px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20d3493e-41d0-45cc-bac4-43657d8883e1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"425aa5d2-fcf9-4094-a52c-73917f47875c","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false,"$$hashKey":"object:12490"}],"$conditionOutputs":[{"stateId":"143e0124-ec4e-462d-8369-efc61791afe6","$connId":"con_63","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"hasAttendant","$$hashKey":"object:12682"}],"$invalid":false,"$$hashKey":"object:12660"},{"stateId":"4c0d9be0-bd3d-4e72-b105-a2ac741e5149","$connId":"con_68","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"hasAttendant","$$hashKey":"object:12709"}],"$invalid":false,"$$hashKey":"object:12661"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"CheckAgentsAvailability","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Key {{config.token}}"},"method":"POST","body":"{\n  \"id\": \"{{random.guid}}\",\n  \"from\": \"{{application.identifier}}@{{application.domain}}\",  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/attendants\"\n}","uri":"https://msging.net/commands","responseStatusVariable":"status","responseBodyVariable":"result"}},{"type":"ExecuteScript","$title":"HandleCheckRequest","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(result) {\n    result = JSON.parse(result)\n    let hasAttendant = false;\n    \n    // Update the value with your team name\n    let team = 'Equipe2';\n\n    if(result.resource && result.resource.total >= 1){\n        hasAttendant  = result.resource.items.some(function(attendant){\n            return (attendant.status === 'Online' && attendant.teams.includes(team));\n        });\n    }\n    return hasAttendant;\n}","inputVariables":["result"],"outputVariable":"hasAttendant"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"20d3493e-41d0-45cc-bac4-43657d8883e1","root":false,"$title":"3.0.2 - Verifica Disponibilidade (Equipe2 )","$position":{"top":"477px","left":"1165px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}